<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>香美市立 大栃小・中学校 特認校スライドショー</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=Noto+Sans+JP:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', 'Noto Sans JP', sans-serif;
            background-color: #f0f2f5;
        }
        .slide-container {
            position: relative;
            width: 100%;
            max-width: 1120px; /* Adjusted for better viewing */
            margin: 2rem auto;
            aspect-ratio: 16 / 9;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            background-color: #F8F9FA;
        }
        .slide {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: none;
            padding: 4%;
            overflow: hidden;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        .slide.active {
            display: flex;
        }
        .nav-arrow {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            width: 50px;
            height: 50px;
            background-color: rgba(0,0,0,0.3);
            color: white;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            z-index: 100;
            user-select: none;
            transition: background-color 0.2s;
        }
        .nav-arrow:hover {
            background-color: rgba(0,0,0,0.6);
        }
        #prev-btn { left: -70px; }
        #next-btn { right: -70px; }
        .slide-counter {
            position: absolute;
            bottom: -40px;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(0,0,0,0.5);
            color: white;
            padding: 5px 15px;
            border-radius: 15px;
            font-size: 0.9rem;
        }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #118AB2;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .interest-checkbox:checked + label {
            background-color: #118AB2;
            color: white;
            border-color: #118AB2;
        }
        .gemini-tab {
            cursor: pointer;
            padding: 0.5rem 1rem;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
        }
        .gemini-tab.active {
            border-bottom-color: #EF476F;
            color: #073B4C;
            font-weight: bold;
        }
    </style>
</head>
<body>

    <div class="slide-container">
        <!-- Slide 1: Title -->
        <div class="slide active" style="background: linear-gradient(135deg, #073B4C, #118AB2);">
            <div class="text-center text-white">
                <h1 class="text-6xl font-bold mb-4 drop-shadow-lg">自然のなかで、未来を学ぶ。</h1>
                <p class="text-3xl drop-shadow-md">香美市立 大栃小・中学校 特認校のご紹介</p>
            </div>
        </div>

        <!-- Slide 2: Tokunin System -->
        <div class="slide">
            <h2 class="text-4xl font-bold mb-8 w-full text-center" style="color: #073B4C;">香美市全域から通える「特認校」制度</h2>
            <div class="flex w-full h-full items-center gap-8">
                <div class="w-1/2 h-full flex flex-col justify-center items-center text-center bg-blue-50 rounded-lg p-6" style="background-color: #E7F3F8;">
                    <span class="text-7xl">🚌</span>
                    <h3 class="text-2xl font-bold mt-4 mb-2" style="color: #118AB2;">安心の通学サポート</h3>
                    <p class="text-lg text-gray-700">土佐山田町から大栃までのバス料金は市の補助により、保護者負担は...</p>
                    <p class="text-7xl font-bold my-4" style="color: #118AB2;">実質 <span class="text-9xl">0</span> 円</p>
                </div>
                <div class="w-1/2 h-full">
                    <img src="https://drive.google.com/uc?export=view&id=1GS5y0lRy7x4-j6bx_MsM4oK85bBPOfb8" alt="豊かな自然に囲まれた学校のイメージ" class="rounded-lg shadow-md w-full h-full object-cover">
                </div>
            </div>
        </div>

        <!-- Slide 3: Education Pillars -->
        <div class="slide">
            <h2 class="text-4xl font-bold mb-8 w-full text-center" style="color: #073B4C;">一人ひとりが主役になる学びのカタチ</h2>
            <div class="grid grid-cols-4 gap-6 w-full">
                <div class="bg-white rounded-lg shadow-md p-6 text-center flex flex-col justify-center items-center h-full">
                    <div class="text-6xl mb-4">🔗</div>
                    <h3 class="text-xl font-bold mb-2" style="color: #073B4C;">小中一貫教育</h3>
                    <p class="text-gray-600">9年間を見通した継続的な学びで、心と体のスムーズな成長をサポートします。</p>
                </div>
                <div class="bg-white rounded-lg shadow-md p-6 text-center flex flex-col justify-center items-center h-full">
                    <div class="text-6xl mb-4">🤝</div>
                    <h3 class="text-xl font-bold mb-2" style="color: #073B4C;">イエナプラン教育</h3>
                    <p class="text-gray-600">対話や協力を重視し、誰もが「幸せ」を感じられる学校を目指しています。</p>
                </div>
                <div class="bg-white rounded-lg shadow-md p-6 text-center flex flex-col justify-center items-center h-full">
                    <div class="text-6xl mb-4">🧑‍🏫</div>
                    <h3 class="text-xl font-bold mb-2" style="color: #073B4C;">少人数での学び</h3>
                    <p class="text-gray-600">落ち着いた環境で、一人ひとりが安心して発表し、深く学べます。</p>
                </div>
                <div class="bg-white rounded-lg shadow-md p-6 text-center flex flex-col justify-center items-center h-full">
                    <div class="text-6xl mb-4">💻</div>
                    <h3 class="text-xl font-bold mb-2" style="color: #073B4C;">ICTの活用</h3>
                    <p class="text-gray-600">タブレットPCを積極的に活用し、未来を生きるために必要な力を育みます。</p>
                </div>
            </div>
        </div>

        <!-- Slide 4: Learning Experience -->
        <div class="slide">
            <h2 class="text-4xl font-bold mb-8 w-full text-center" style="color: #073B4C;">日本トップクラスの自然と地域が教室</h2>
            <div class="flex w-full h-full items-center gap-8">
                <div class="w-1/2 h-full flex justify-center items-center">
                    <div class="relative w-full h-full max-h-[400px]">
                        <canvas id="learningMixChart"></canvas>
                    </div>
                </div>
                <div class="w-1/2">
                    <h3 class="text-2xl font-bold mb-4" style="color: #073B4C;">多様な体験活動のバランス</h3>
                    <p class="text-gray-700 mb-4 text-lg">大栃の学びは、豊かな「自然体験」と、温かい「地域交流」が大きな柱。学校での学びと組み合わせることで、バランスの取れた成長を促します。</p>
                    <ul class="space-y-3 text-lg">
                        <li class="flex items-center"><div class="w-5 h-5 rounded-full mr-3" style="background-color: #06D6A0;"></div><span><strong class="font-bold">自然体験:</strong> 登山、川遊び、ゆずの収穫など</span></li>
                        <li class="flex items-center"><div class="w-5 h-5 rounded-full mr-3" style="background-color: #FFD166;"></div><span><strong class="font-bold">地域交流:</strong> お茶煎り体験、地域のお祭り参加など</span></li>
                        <li class="flex items-center"><div class="w-5 h-5 rounded-full mr-3" style="background-color: #118AB2;"></div><span><strong class="font-bold">学校での学び:</strong> 基礎学力とICTスキルを育成</span></li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Slide 5: Global Connections -->
        <div class="slide">
            <h2 class="text-4xl font-bold mb-8 w-full text-center" style="color: #073B4C;">小さな学校から、大きな世界へ</h2>
            <div class="w-full flex justify-center items-center gap-12">
                <div class="text-center flowchart-box bg-white p-6 rounded-lg border-2" style="border-color: #EF476F;">
                    <div class="text-5xl">🌏</div>
                    <p class="font-bold text-lg" style="color: #073B4C;">海外・他県との<br>遠隔交流</p>
                </div>
                <div class="text-center flowchart-box bg-white p-8 rounded-full border-4 shadow-lg" style="border-color: #118AB2;">
                    <div class="text-4xl">🏫</div>
                    <p class="font-bold text-2xl" style="color: #073B4C;">大栃小・中学校</p>
                </div>
                <div class="flex flex-col gap-6">
                   <div class="text-center flowchart-box bg-white p-6 rounded-lg border-2" style="border-color: #06D6A0;">
                        <div class="text-5xl">🗾</div>
                        <p class="font-bold text-lg" style="color: #073B4C;">北海道積丹町<br>との交流</p>
                    </div>
                     <div class="text-center flowchart-box bg-white p-6 rounded-lg border-2" style="border-color: #FFD166;">
                        <div class="text-5xl">🎓</div>
                        <p class="font-bold text-lg" style="color: #073B4C;">高知工科大学<br>との連携</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Slide 6: School Life -->
        <div class="slide">
            <h2 class="text-4xl font-bold mb-8 w-full text-center" style="color: #073B4C;">毎日がもっと楽しくなる学校生活</h2>
            <div class="grid grid-cols-3 gap-6 w-full h-full">
                 <div class="bg-white rounded-lg shadow-md p-4 text-center flex flex-col">
                    <img src="https://drive.google.com/uc?export=view&id=1H9uav-GAf0Tjh9COlktopUxOY1RRDNWW" alt="美味しい給食のイメージ" class="rounded-lg mb-4 w-full h-48 object-cover flex-grow">
                    <h3 class="text-xl font-bold" style="color: #073B4C;">自慢のおいしい給食</h3>
                 </div>
                 <div class="bg-white rounded-lg shadow-md p-4 text-center flex flex-col">
                    <img src="https://placehold.co/400x300/118AB2/FFFFFF?text=新制服" alt="新しくなった中学校の制服のイメージ" class="rounded-lg mb-4 w-full h-48 object-cover flex-grow">
                    <h3 class="text-xl font-bold" style="color: #073B4C;">新しい中学校の制服</h3>
                 </div>
                 <div class="bg-white rounded-lg shadow-md p-4 text-center flex flex-col">
                    <img src="https://placehold.co/400x300/06D6A0/FFFFFF?text=合同行事" alt="小中合同行事のイメージ" class="rounded-lg mb-4 w-full h-48 object-cover flex-grow">
                    <h3 class="text-xl font-bold" style="color: #073B4C;">楽しい小中合同行事</h3>
                 </div>
            </div>
        </div>

        <!-- Slide 7: Gemini Feature -->
        <div class="slide">
            <h2 class="text-4xl font-bold mb-4 w-full text-center" style="color: #073B4C;">✨ AIがお答えします！大栃の魅力 ✨</h2>
            <div class="flex w-full h-full items-stretch gap-6">
                <div class="w-1/2 flex flex-col">
                    <div class="flex justify-center border-b mb-4">
                        <div id="tab-story" class="gemini-tab active">物語ジェネレーター</div>
                        <div id="tab-qa" class="gemini-tab">なんでも相談室</div>
                    </div>
                    <div id="story-generator-content" class="flex flex-col items-center flex-grow">
                        <p class="text-center text-gray-600 mb-4">興味に合わせてAIが特別な一日を物語にします。</p>
                        <div class="flex flex-wrap justify-center gap-2 mb-4">
                            <div><input type="checkbox" id="interest-nature" value="自然" class="hidden interest-checkbox"><label for="interest-nature" class="cursor-pointer border-2 text-sm border-gray-300 rounded-full px-3 py-1 transition-colors">🌳 自然</label></div>
                            <div><input type="checkbox" id="interest-art" value="芸術" class="hidden interest-checkbox"><label for="interest-art" class="cursor-pointer border-2 text-sm border-gray-300 rounded-full px-3 py-1 transition-colors">🎨 芸術</label></div>
                            <div><input type="checkbox" id="interest-sports" value="運動" class="hidden interest-checkbox"><label for="interest-sports" class="cursor-pointer border-2 text-sm border-gray-300 rounded-full px-3 py-1 transition-colors">🏃 運動</label></div>
                            <div><input type="checkbox" id="interest-tech" value="テクノロジー" class="hidden interest-checkbox"><label for="interest-tech" class="cursor-pointer border-2 text-sm border-gray-300 rounded-full px-3 py-1 transition-colors">🔬 テクノロジー</label></div>
                        </div>
                        <button id="generate-story-btn" class="text-white font-bold py-2 px-6 rounded-lg" style="background-color: #EF476F;">物語を生成</button>
                    </div>
                    <div id="qa-content" class="hidden flex flex-col items-center flex-grow">
                         <p class="text-center text-gray-600 mb-4">学校について知りたいことをAIに質問してみましょう。</p>
                         <input type="text" id="qa-input" placeholder="例：どんな部活動がありますか？" class="border-2 border-gray-300 rounded-lg p-2 w-full mb-4">
                         <button id="ask-qa-btn" class="text-white font-bold py-2 px-6 rounded-lg" style="background-color: #118AB2;">質問する</button>
                    </div>
                </div>
                <div id="story-result-container" class="w-1/2 min-h-[200px] bg-blue-50 rounded-lg p-4 flex justify-center items-center" style="background-color: #E7F3F8;">
                    <div id="loader" class="loader hidden"></div>
                    <p id="story-text" class="text-gray-800 whitespace-pre-wrap text-sm"></p>
                </div>
            </div>
        </div>

        <!-- Slide 8: Call to Action -->
        <div class="slide">
            <h2 class="text-4xl font-bold mb-8 w-full text-center" style="color: #073B4C;">私たちと一緒に学びませんか？</h2>
            <div class="flex w-full h-full items-center justify-around gap-8">
                <div class="text-center">
                    <h3 class="text-2xl font-bold mb-2">オープンスクール</h3>
                    <p class="text-4xl font-bold" style="color: #118AB2;">10月最終日曜日</p>
                    <p class="text-lg mt-2">学校の様子を直接ご覧いただけます。</p>
                </div>
                <div class="text-center">
                    <h3 class="text-2xl font-bold mb-2">募集期間</h3>
                    <p class="text-4xl font-bold" style="color: #118AB2;">9/2 ~ 12/10</p>
                    <p class="text-lg mt-2">学校見学は随時受付中です。</p>
                </div>
                <div class="text-center">
                    <h3 class="text-2xl font-bold mb-2">お問い合わせ</h3>
                     <a href="https://sites.google.com/g.kochinet.ed.jp/odochi-tokunin/" target="_blank" class="inline-block text-white font-bold py-4 px-8 rounded-lg text-xl mt-2" style="background-color: #EF476F;">
                        詳しくはこちら
                    </a>
                </div>
            </div>
        </div>

        <!-- Navigation -->
        <div id="prev-btn" class="nav-arrow">&#10094;</div>
        <div id="next-btn" class="nav-arrow">&#10095;</div>
        <div class="slide-counter" id="slide-counter">1 / 8</div>
    </div>

    <script>
        let currentSlide = 0;
        const slides = document.querySelectorAll('.slide');
        const slideCounter = document.getElementById('slide-counter');
        const totalSlides = slides.length;

        function showSlide(n) {
            slides.forEach(slide => slide.classList.remove('active'));
            slides[n].classList.add('active');
            slideCounter.textContent = `${n + 1} / ${totalSlides}`;
        }

        function nextSlide() {
            currentSlide = (currentSlide + 1) % totalSlides;
            showSlide(currentSlide);
        }

        function prevSlide() {
            currentSlide = (currentSlide - 1 + totalSlides) % totalSlides;
            showSlide(currentSlide);
        }

        document.getElementById('next-btn').addEventListener('click', nextSlide);
        document.getElementById('prev-btn').addEventListener('click', prevSlide);

        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowRight') {
                nextSlide();
            } else if (e.key === 'ArrowLeft') {
                prevSlide();
            }
        });

        showSlide(currentSlide);

        async function callGeminiApi(prompt, retries = 3, delay = 1000) {
            const apiKey = ""; 
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
            const payload = { contents: [{ role: "user", parts: [{ text: prompt }] }] };

            for (let i = 0; i < retries; i++) {
                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                    const result = await response.json();
                    if (result.candidates?.[0]?.content?.parts?.[0]?.text) {
                        return result.candidates[0].content.parts[0].text;
                    } else {
                        return "AIからの応答がありませんでした。";
                    }
                } catch (error) {
                    if (i === retries - 1) {
                        console.error("Error calling Gemini API:", error);
                        return "AIとの通信中にエラーが発生しました。";
                    }
                    await new Promise(res => setTimeout(res, delay * Math.pow(2, i)));
                }
            }
        }

        document.addEventListener('DOMContentLoaded', function () {
            const generateBtn = document.getElementById('generate-story-btn');
            const resultContainer = document.getElementById('story-result-container');
            const storyTextElem = document.getElementById('story-text');
            const loader = document.getElementById('loader');
            const askQaBtn = document.getElementById('ask-qa-btn');
            const qaInput = document.getElementById('qa-input');
            const tabStory = document.getElementById('tab-story');
            const tabQa = document.getElementById('tab-qa');
            const storyContent = document.getElementById('story-generator-content');
            const qaContent = document.getElementById('qa-content');

            tabStory.addEventListener('click', () => {
                tabStory.classList.add('active');
                tabQa.classList.remove('active');
                storyContent.classList.remove('hidden');
                qaContent.classList.add('hidden');
                storyTextElem.textContent = '';
            });

            tabQa.addEventListener('click', () => {
                tabQa.classList.add('active');
                tabStory.classList.remove('active');
                qaContent.classList.remove('hidden');
                storyContent.classList.add('hidden');
                storyTextElem.textContent = '';
            });

            generateBtn.addEventListener('click', async () => {
                const selectedInterests = Array.from(document.querySelectorAll('.interest-checkbox:checked')).map(cb => cb.value);
                if (selectedInterests.length === 0) {
                    storyTextElem.textContent = '興味のあることを1つ以上選んでください。';
                    return;
                }
                storyTextElem.textContent = '';
                loader.classList.remove('hidden');
                const interestsText = selectedInterests.join('と');
                const prompt = `あなたは、自然豊かな場所にある日本の「大栃小・中学校」に通う、元気でフレンドリーな生徒です。この学校は少人数で、地域とのつながりや体験学習を大切にしています。${interestsText}に興味がある転校希望の生徒に向けて、その興味と学校の特色（川遊び、ゆずの収穫、地域のお祭りなど）を盛り込みながら、学校での楽しい一日を想像させる短い物語（200字程度）を日本語で作成してください。物語の文章だけを返してください。`;
                const story = await callGeminiApi(prompt);
                loader.classList.add('hidden');
                storyTextElem.textContent = story;
            });

            askQaBtn.addEventListener('click', async () => {
                const question = qaInput.value.trim();
                if (!question) {
                    storyTextElem.textContent = '質問を入力してください。';
                    return;
                }
                storyTextElem.textContent = '';
                loader.classList.remove('hidden');
                const schoolInfo = `- 学校名: 香美市立大栃小・中学校\n- 特徴: 小中一貫教育、特認校制度（香美市全域から通学可能）\n- 教育方針: イエナプラン教育のエッセンスを取り入れ、対話や協力を重視。少人数教育。ICT活用。\n- 環境: 豊かな自然に囲まれている。\n- 活動: 登山、川遊び、ゆずの収穫、お茶煎り体験、地域のお祭り参加など、自然や地域と連携した体験学習が豊富。\n- 交流: 北海道積丹町、韓国、高知工科大学などと交流活動がある。\n- 学校生活: 給食が美味しいと評判。中学校の制服は新しいデザイン。小中合同行事も多い。\n- 通学: 土佐山田町からのバス料金は市の補助で実質無料。`;
                const prompt = `あなたは香美市立大栃小・中学校の親切なAI相談員です。以下の学校情報に基づいて、丁寧で分かりやすい言葉を使い、子供たちや保護者からの質問に日本語で答えてください。\n\n[学校情報]\n${schoolInfo}\n\n[質問]\n${question}`;
                const answer = await callGeminiApi(prompt);
                loader.classList.add('hidden');
                storyTextElem.textContent = answer;
            });

            const ctx = document.getElementById('learningMixChart').getContext('2d');
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['自然体験', '地域交流', '学校での学び'],
                    datasets: [{ data: [40, 35, 25], backgroundColor: ['#06D6A0', '#FFD166', '#118AB2'], borderColor: '#F8F9FA', borderWidth: 6, hoverOffset: 8 }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '60%',
                    plugins: {
                        legend: { position: 'bottom', labels: { padding: 20, font: { size: 16 } } },
                        tooltip: {
                            callbacks: {
                                title: (tooltipItems) => {
                                    let label = tooltipItems[0].chart.data.labels[tooltipItems[0].dataIndex];
                                    return Array.isArray(label) ? label.join(' ') : label;
                                }
                            }
                        }
                    }
                }
            });
        });
    </script>
</body>
</html>
