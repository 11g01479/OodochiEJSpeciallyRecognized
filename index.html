<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é¦™ç¾å¸‚ç«‹ å¤§æ ƒå°ãƒ»ä¸­å­¦æ ¡ ç‰¹èªæ ¡ã‚¹ãƒ©ã‚¤ãƒ‰ã‚·ãƒ§ãƒ¼</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=Noto+Sans+JP:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', 'Noto Sans JP', sans-serif;
            background-color: #f0f2f5;
        }
        .slide-container {
            position: relative;
            width: 100%;
            max-width: 1120px; /* Adjusted for better viewing */
            margin: 2rem auto;
            aspect-ratio: 16 / 9;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            background-color: #F8F9FA;
        }
        .slide {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: none;
            padding: 4%;
            overflow: hidden;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        .slide.active {
            display: flex;
        }
        .nav-arrow {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            width: 50px;
            height: 50px;
            background-color: rgba(0,0,0,0.3);
            color: white;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            z-index: 100;
            user-select: none;
            transition: background-color 0.2s;
        }
        .nav-arrow:hover {
            background-color: rgba(0,0,0,0.6);
        }
        #prev-btn { left: -70px; }
        #next-btn { right: -70px; }
        .slide-counter {
            position: absolute;
            bottom: -40px;
            left: 50%;
            transform: translateX(-50%);
            background-color: rgba(0,0,0,0.5);
            color: white;
            padding: 5px 15px;
            border-radius: 15px;
            font-size: 0.9rem;
        }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #118AB2;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .interest-checkbox:checked + label {
            background-color: #118AB2;
            color: white;
            border-color: #118AB2;
        }
        .gemini-tab {
            cursor: pointer;
            padding: 0.5rem 1rem;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
        }
        .gemini-tab.active {
            border-bottom-color: #EF476F;
            color: #073B4C;
            font-weight: bold;
        }
    </style>
</head>
<body>

    <div class="slide-container">
        <!-- Slide 1: Title -->
        <div class="slide active" style="background: linear-gradient(135deg, #073B4C, #118AB2);">
            <div class="text-center text-white">
                <h1 class="text-6xl font-bold mb-4 drop-shadow-lg">è‡ªç„¶ã®ãªã‹ã§ã€æœªæ¥ã‚’å­¦ã¶ã€‚</h1>
                <p class="text-3xl drop-shadow-md">é¦™ç¾å¸‚ç«‹ å¤§æ ƒå°ãƒ»ä¸­å­¦æ ¡ ç‰¹èªæ ¡ã®ã”ç´¹ä»‹</p>
            </div>
        </div>

        <!-- Slide 2: Tokunin System -->
        <div class="slide">
            <h2 class="text-4xl font-bold mb-8 w-full text-center" style="color: #073B4C;">é¦™ç¾å¸‚å…¨åŸŸã‹ã‚‰é€šãˆã‚‹ã€Œç‰¹èªæ ¡ã€åˆ¶åº¦</h2>
            <div class="flex w-full h-full items-center gap-8">
                <div class="w-1/2 h-full flex flex-col justify-center items-center text-center bg-blue-50 rounded-lg p-6" style="background-color: #E7F3F8;">
                    <span class="text-7xl">ğŸšŒ</span>
                    <h3 class="text-2xl font-bold mt-4 mb-2" style="color: #118AB2;">å®‰å¿ƒã®é€šå­¦ã‚µãƒãƒ¼ãƒˆ</h3>
                    <p class="text-lg text-gray-700">åœŸä½å±±ç”°ç”ºã‹ã‚‰å¤§æ ƒã¾ã§ã®ãƒã‚¹æ–™é‡‘ã¯å¸‚ã®è£œåŠ©ã«ã‚ˆã‚Šã€ä¿è­·è€…è² æ‹…ã¯...</p>
                    <p class="text-7xl font-bold my-4" style="color: #118AB2;">å®Ÿè³ª <span class="text-9xl">0</span> å††</p>
                </div>
                <div class="w-1/2 h-full">
                    <img src="https://drive.google.com/uc?export=view&id=1GS5y0lRy7x4-j6bx_MsM4oK85bBPOfb8" alt="è±Šã‹ãªè‡ªç„¶ã«å›²ã¾ã‚ŒãŸå­¦æ ¡ã®ã‚¤ãƒ¡ãƒ¼ã‚¸" class="rounded-lg shadow-md w-full h-full object-cover">
                </div>
            </div>
        </div>

        <!-- Slide 3: Education Pillars -->
        <div class="slide">
            <h2 class="text-4xl font-bold mb-8 w-full text-center" style="color: #073B4C;">ä¸€äººã²ã¨ã‚ŠãŒä¸»å½¹ã«ãªã‚‹å­¦ã³ã®ã‚«ã‚¿ãƒ</h2>
            <div class="grid grid-cols-4 gap-6 w-full">
                <div class="bg-white rounded-lg shadow-md p-6 text-center flex flex-col justify-center items-center h-full">
                    <div class="text-6xl mb-4">ğŸ”—</div>
                    <h3 class="text-xl font-bold mb-2" style="color: #073B4C;">å°ä¸­ä¸€è²«æ•™è‚²</h3>
                    <p class="text-gray-600">9å¹´é–“ã‚’è¦‹é€šã—ãŸç¶™ç¶šçš„ãªå­¦ã³ã§ã€å¿ƒã¨ä½“ã®ã‚¹ãƒ ãƒ¼ã‚ºãªæˆé•·ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¾ã™ã€‚</p>
                </div>
                <div class="bg-white rounded-lg shadow-md p-6 text-center flex flex-col justify-center items-center h-full">
                    <div class="text-6xl mb-4">ğŸ¤</div>
                    <h3 class="text-xl font-bold mb-2" style="color: #073B4C;">ã‚¤ã‚¨ãƒŠãƒ—ãƒ©ãƒ³æ•™è‚²</h3>
                    <p class="text-gray-600">å¯¾è©±ã‚„å”åŠ›ã‚’é‡è¦–ã—ã€èª°ã‚‚ãŒã€Œå¹¸ã›ã€ã‚’æ„Ÿã˜ã‚‰ã‚Œã‚‹å­¦æ ¡ã‚’ç›®æŒ‡ã—ã¦ã„ã¾ã™ã€‚</p>
                </div>
                <div class="bg-white rounded-lg shadow-md p-6 text-center flex flex-col justify-center items-center h-full">
                    <div class="text-6xl mb-4">ğŸ§‘â€ğŸ«</div>
                    <h3 class="text-xl font-bold mb-2" style="color: #073B4C;">å°‘äººæ•°ã§ã®å­¦ã³</h3>
                    <p class="text-gray-600">è½ã¡ç€ã„ãŸç’°å¢ƒã§ã€ä¸€äººã²ã¨ã‚ŠãŒå®‰å¿ƒã—ã¦ç™ºè¡¨ã—ã€æ·±ãå­¦ã¹ã¾ã™ã€‚</p>
                </div>
                <div class="bg-white rounded-lg shadow-md p-6 text-center flex flex-col justify-center items-center h-full">
                    <div class="text-6xl mb-4">ğŸ’»</div>
                    <h3 class="text-xl font-bold mb-2" style="color: #073B4C;">ICTã®æ´»ç”¨</h3>
                    <p class="text-gray-600">ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆPCã‚’ç©æ¥µçš„ã«æ´»ç”¨ã—ã€æœªæ¥ã‚’ç”Ÿãã‚‹ãŸã‚ã«å¿…è¦ãªåŠ›ã‚’è‚²ã¿ã¾ã™ã€‚</p>
                </div>
            </div>
        </div>

        <!-- Slide 4: Learning Experience -->
        <div class="slide">
            <h2 class="text-4xl font-bold mb-8 w-full text-center" style="color: #073B4C;">æ—¥æœ¬ãƒˆãƒƒãƒ—ã‚¯ãƒ©ã‚¹ã®è‡ªç„¶ã¨åœ°åŸŸãŒæ•™å®¤</h2>
            <div class="flex w-full h-full items-center gap-8">
                <div class="w-1/2 h-full flex justify-center items-center">
                    <div class="relative w-full h-full max-h-[400px]">
                        <canvas id="learningMixChart"></canvas>
                    </div>
                </div>
                <div class="w-1/2">
                    <h3 class="text-2xl font-bold mb-4" style="color: #073B4C;">å¤šæ§˜ãªä½“é¨“æ´»å‹•ã®ãƒãƒ©ãƒ³ã‚¹</h3>
                    <p class="text-gray-700 mb-4 text-lg">å¤§æ ƒã®å­¦ã³ã¯ã€è±Šã‹ãªã€Œè‡ªç„¶ä½“é¨“ã€ã¨ã€æ¸©ã‹ã„ã€Œåœ°åŸŸäº¤æµã€ãŒå¤§ããªæŸ±ã€‚å­¦æ ¡ã§ã®å­¦ã³ã¨çµ„ã¿åˆã‚ã›ã‚‹ã“ã¨ã§ã€ãƒãƒ©ãƒ³ã‚¹ã®å–ã‚ŒãŸæˆé•·ã‚’ä¿ƒã—ã¾ã™ã€‚</p>
                    <ul class="space-y-3 text-lg">
                        <li class="flex items-center"><div class="w-5 h-5 rounded-full mr-3" style="background-color: #06D6A0;"></div><span><strong class="font-bold">è‡ªç„¶ä½“é¨“:</strong> ç™»å±±ã€å·éŠã³ã€ã‚†ãšã®åç©«ãªã©</span></li>
                        <li class="flex items-center"><div class="w-5 h-5 rounded-full mr-3" style="background-color: #FFD166;"></div><span><strong class="font-bold">åœ°åŸŸäº¤æµ:</strong> ãŠèŒ¶ç…ã‚Šä½“é¨“ã€åœ°åŸŸã®ãŠç¥­ã‚Šå‚åŠ ãªã©</span></li>
                        <li class="flex items-center"><div class="w-5 h-5 rounded-full mr-3" style="background-color: #118AB2;"></div><span><strong class="font-bold">å­¦æ ¡ã§ã®å­¦ã³:</strong> åŸºç¤å­¦åŠ›ã¨ICTã‚¹ã‚­ãƒ«ã‚’è‚²æˆ</span></li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Slide 5: Global Connections -->
        <div class="slide">
            <h2 class="text-4xl font-bold mb-8 w-full text-center" style="color: #073B4C;">å°ã•ãªå­¦æ ¡ã‹ã‚‰ã€å¤§ããªä¸–ç•Œã¸</h2>
            <div class="w-full flex justify-center items-center gap-12">
                <div class="text-center flowchart-box bg-white p-6 rounded-lg border-2" style="border-color: #EF476F;">
                    <div class="text-5xl">ğŸŒ</div>
                    <p class="font-bold text-lg" style="color: #073B4C;">æµ·å¤–ãƒ»ä»–çœŒã¨ã®<br>é éš”äº¤æµ</p>
                </div>
                <div class="text-center flowchart-box bg-white p-8 rounded-full border-4 shadow-lg" style="border-color: #118AB2;">
                    <div class="text-4xl">ğŸ«</div>
                    <p class="font-bold text-2xl" style="color: #073B4C;">å¤§æ ƒå°ãƒ»ä¸­å­¦æ ¡</p>
                </div>
                <div class="flex flex-col gap-6">
                   <div class="text-center flowchart-box bg-white p-6 rounded-lg border-2" style="border-color: #06D6A0;">
                        <div class="text-5xl">ğŸ—¾</div>
                        <p class="font-bold text-lg" style="color: #073B4C;">åŒ—æµ·é“ç©ä¸¹ç”º<br>ã¨ã®äº¤æµ</p>
                    </div>
                     <div class="text-center flowchart-box bg-white p-6 rounded-lg border-2" style="border-color: #FFD166;">
                        <div class="text-5xl">ğŸ“</div>
                        <p class="font-bold text-lg" style="color: #073B4C;">é«˜çŸ¥å·¥ç§‘å¤§å­¦<br>ã¨ã®é€£æº</p>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Slide 6: School Life -->
        <div class="slide">
            <h2 class="text-4xl font-bold mb-8 w-full text-center" style="color: #073B4C;">æ¯æ—¥ãŒã‚‚ã£ã¨æ¥½ã—ããªã‚‹å­¦æ ¡ç”Ÿæ´»</h2>
            <div class="grid grid-cols-3 gap-6 w-full h-full">
                 <div class="bg-white rounded-lg shadow-md p-4 text-center flex flex-col">
                    <img src="https://drive.google.com/uc?export=view&id=1H9uav-GAf0Tjh9COlktopUxOY1RRDNWW" alt="ç¾å‘³ã—ã„çµ¦é£Ÿã®ã‚¤ãƒ¡ãƒ¼ã‚¸" class="rounded-lg mb-4 w-full h-48 object-cover flex-grow">
                    <h3 class="text-xl font-bold" style="color: #073B4C;">è‡ªæ…¢ã®ãŠã„ã—ã„çµ¦é£Ÿ</h3>
                 </div>
                 <div class="bg-white rounded-lg shadow-md p-4 text-center flex flex-col">
                    <img src="https://placehold.co/400x300/118AB2/FFFFFF?text=æ–°åˆ¶æœ" alt="æ–°ã—ããªã£ãŸä¸­å­¦æ ¡ã®åˆ¶æœã®ã‚¤ãƒ¡ãƒ¼ã‚¸" class="rounded-lg mb-4 w-full h-48 object-cover flex-grow">
                    <h3 class="text-xl font-bold" style="color: #073B4C;">æ–°ã—ã„ä¸­å­¦æ ¡ã®åˆ¶æœ</h3>
                 </div>
                 <div class="bg-white rounded-lg shadow-md p-4 text-center flex flex-col">
                    <img src="https://placehold.co/400x300/06D6A0/FFFFFF?text=åˆåŒè¡Œäº‹" alt="å°ä¸­åˆåŒè¡Œäº‹ã®ã‚¤ãƒ¡ãƒ¼ã‚¸" class="rounded-lg mb-4 w-full h-48 object-cover flex-grow">
                    <h3 class="text-xl font-bold" style="color: #073B4C;">æ¥½ã—ã„å°ä¸­åˆåŒè¡Œäº‹</h3>
                 </div>
            </div>
        </div>

        <!-- Slide 7: Gemini Feature -->
        <div class="slide">
            <h2 class="text-4xl font-bold mb-4 w-full text-center" style="color: #073B4C;">âœ¨ AIãŒãŠç­”ãˆã—ã¾ã™ï¼å¤§æ ƒã®é­…åŠ› âœ¨</h2>
            <div class="flex w-full h-full items-stretch gap-6">
                <div class="w-1/2 flex flex-col">
                    <div class="flex justify-center border-b mb-4">
                        <div id="tab-story" class="gemini-tab active">ç‰©èªã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼</div>
                        <div id="tab-qa" class="gemini-tab">ãªã‚“ã§ã‚‚ç›¸è«‡å®¤</div>
                    </div>
                    <div id="story-generator-content" class="flex flex-col items-center flex-grow">
                        <p class="text-center text-gray-600 mb-4">èˆˆå‘³ã«åˆã‚ã›ã¦AIãŒç‰¹åˆ¥ãªä¸€æ—¥ã‚’ç‰©èªã«ã—ã¾ã™ã€‚</p>
                        <div class="flex flex-wrap justify-center gap-2 mb-4">
                            <div><input type="checkbox" id="interest-nature" value="è‡ªç„¶" class="hidden interest-checkbox"><label for="interest-nature" class="cursor-pointer border-2 text-sm border-gray-300 rounded-full px-3 py-1 transition-colors">ğŸŒ³ è‡ªç„¶</label></div>
                            <div><input type="checkbox" id="interest-art" value="èŠ¸è¡“" class="hidden interest-checkbox"><label for="interest-art" class="cursor-pointer border-2 text-sm border-gray-300 rounded-full px-3 py-1 transition-colors">ğŸ¨ èŠ¸è¡“</label></div>
                            <div><input type="checkbox" id="interest-sports" value="é‹å‹•" class="hidden interest-checkbox"><label for="interest-sports" class="cursor-pointer border-2 text-sm border-gray-300 rounded-full px-3 py-1 transition-colors">ğŸƒ é‹å‹•</label></div>
                            <div><input type="checkbox" id="interest-tech" value="ãƒ†ã‚¯ãƒãƒ­ã‚¸ãƒ¼" class="hidden interest-checkbox"><label for="interest-tech" class="cursor-pointer border-2 text-sm border-gray-300 rounded-full px-3 py-1 transition-colors">ğŸ”¬ ãƒ†ã‚¯ãƒãƒ­ã‚¸ãƒ¼</label></div>
                        </div>
                        <button id="generate-story-btn" class="text-white font-bold py-2 px-6 rounded-lg" style="background-color: #EF476F;">ç‰©èªã‚’ç”Ÿæˆ</button>
                    </div>
                    <div id="qa-content" class="hidden flex flex-col items-center flex-grow">
                         <p class="text-center text-gray-600 mb-4">å­¦æ ¡ã«ã¤ã„ã¦çŸ¥ã‚ŠãŸã„ã“ã¨ã‚’AIã«è³ªå•ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚</p>
                         <input type="text" id="qa-input" placeholder="ä¾‹ï¼šã©ã‚“ãªéƒ¨æ´»å‹•ãŒã‚ã‚Šã¾ã™ã‹ï¼Ÿ" class="border-2 border-gray-300 rounded-lg p-2 w-full mb-4">
                         <button id="ask-qa-btn" class="text-white font-bold py-2 px-6 rounded-lg" style="background-color: #118AB2;">è³ªå•ã™ã‚‹</button>
                    </div>
                </div>
                <div id="story-result-container" class="w-1/2 min-h-[200px] bg-blue-50 rounded-lg p-4 flex justify-center items-center" style="background-color: #E7F3F8;">
                    <div id="loader" class="loader hidden"></div>
                    <p id="story-text" class="text-gray-800 whitespace-pre-wrap text-sm"></p>
                </div>
            </div>
        </div>

        <!-- Slide 8: Call to Action -->
        <div class="slide">
            <h2 class="text-4xl font-bold mb-8 w-full text-center" style="color: #073B4C;">ç§ãŸã¡ã¨ä¸€ç·’ã«å­¦ã³ã¾ã›ã‚“ã‹ï¼Ÿ</h2>
            <div class="flex w-full h-full items-center justify-around gap-8">
                <div class="text-center">
                    <h3 class="text-2xl font-bold mb-2">ã‚ªãƒ¼ãƒ—ãƒ³ã‚¹ã‚¯ãƒ¼ãƒ«</h3>
                    <p class="text-4xl font-bold" style="color: #118AB2;">10æœˆæœ€çµ‚æ—¥æ›œæ—¥</p>
                    <p class="text-lg mt-2">å­¦æ ¡ã®æ§˜å­ã‚’ç›´æ¥ã”è¦§ã„ãŸã ã‘ã¾ã™ã€‚</p>
                </div>
                <div class="text-center">
                    <h3 class="text-2xl font-bold mb-2">å‹Ÿé›†æœŸé–“</h3>
                    <p class="text-4xl font-bold" style="color: #118AB2;">9/2 ~ 12/10</p>
                    <p class="text-lg mt-2">å­¦æ ¡è¦‹å­¦ã¯éšæ™‚å—ä»˜ä¸­ã§ã™ã€‚</p>
                </div>
                <div class="text-center">
                    <h3 class="text-2xl font-bold mb-2">ãŠå•ã„åˆã‚ã›</h3>
                     <a href="https://sites.google.com/g.kochinet.ed.jp/odochi-tokunin/" target="_blank" class="inline-block text-white font-bold py-4 px-8 rounded-lg text-xl mt-2" style="background-color: #EF476F;">
                        è©³ã—ãã¯ã“ã¡ã‚‰
                    </a>
                </div>
            </div>
        </div>

        <!-- Navigation -->
        <div id="prev-btn" class="nav-arrow">&#10094;</div>
        <div id="next-btn" class="nav-arrow">&#10095;</div>
        <div class="slide-counter" id="slide-counter">1 / 8</div>
    </div>

    <script>
        let currentSlide = 0;
        const slides = document.querySelectorAll('.slide');
        const slideCounter = document.getElementById('slide-counter');
        const totalSlides = slides.length;

        function showSlide(n) {
            slides.forEach(slide => slide.classList.remove('active'));
            slides[n].classList.add('active');
            slideCounter.textContent = `${n + 1} / ${totalSlides}`;
        }

        function nextSlide() {
            currentSlide = (currentSlide + 1) % totalSlides;
            showSlide(currentSlide);
        }

        function prevSlide() {
            currentSlide = (currentSlide - 1 + totalSlides) % totalSlides;
            showSlide(currentSlide);
        }

        document.getElementById('next-btn').addEventListener('click', nextSlide);
        document.getElementById('prev-btn').addEventListener('click', prevSlide);

        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowRight') {
                nextSlide();
            } else if (e.key === 'ArrowLeft') {
                prevSlide();
            }
        });

        showSlide(currentSlide);

        async function callGeminiApi(prompt, retries = 3, delay = 1000) {
            const apiKey = ""; 
            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
            const payload = { contents: [{ role: "user", parts: [{ text: prompt }] }] };

            for (let i = 0; i < retries; i++) {
                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                    const result = await response.json();
                    if (result.candidates?.[0]?.content?.parts?.[0]?.text) {
                        return result.candidates[0].content.parts[0].text;
                    } else {
                        return "AIã‹ã‚‰ã®å¿œç­”ãŒã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚";
                    }
                } catch (error) {
                    if (i === retries - 1) {
                        console.error("Error calling Gemini API:", error);
                        return "AIã¨ã®é€šä¿¡ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚";
                    }
                    await new Promise(res => setTimeout(res, delay * Math.pow(2, i)));
                }
            }
        }

        document.addEventListener('DOMContentLoaded', function () {
            const generateBtn = document.getElementById('generate-story-btn');
            const resultContainer = document.getElementById('story-result-container');
            const storyTextElem = document.getElementById('story-text');
            const loader = document.getElementById('loader');
            const askQaBtn = document.getElementById('ask-qa-btn');
            const qaInput = document.getElementById('qa-input');
            const tabStory = document.getElementById('tab-story');
            const tabQa = document.getElementById('tab-qa');
            const storyContent = document.getElementById('story-generator-content');
            const qaContent = document.getElementById('qa-content');

            tabStory.addEventListener('click', () => {
                tabStory.classList.add('active');
                tabQa.classList.remove('active');
                storyContent.classList.remove('hidden');
                qaContent.classList.add('hidden');
                storyTextElem.textContent = '';
            });

            tabQa.addEventListener('click', () => {
                tabQa.classList.add('active');
                tabStory.classList.remove('active');
                qaContent.classList.remove('hidden');
                storyContent.classList.add('hidden');
                storyTextElem.textContent = '';
            });

            generateBtn.addEventListener('click', async () => {
                const selectedInterests = Array.from(document.querySelectorAll('.interest-checkbox:checked')).map(cb => cb.value);
                if (selectedInterests.length === 0) {
                    storyTextElem.textContent = 'èˆˆå‘³ã®ã‚ã‚‹ã“ã¨ã‚’1ã¤ä»¥ä¸Šé¸ã‚“ã§ãã ã•ã„ã€‚';
                    return;
                }
                storyTextElem.textContent = '';
                loader.classList.remove('hidden');
                const interestsText = selectedInterests.join('ã¨');
                const prompt = `ã‚ãªãŸã¯ã€è‡ªç„¶è±Šã‹ãªå ´æ‰€ã«ã‚ã‚‹æ—¥æœ¬ã®ã€Œå¤§æ ƒå°ãƒ»ä¸­å­¦æ ¡ã€ã«é€šã†ã€å…ƒæ°—ã§ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼ãªç”Ÿå¾’ã§ã™ã€‚ã“ã®å­¦æ ¡ã¯å°‘äººæ•°ã§ã€åœ°åŸŸã¨ã®ã¤ãªãŒã‚Šã‚„ä½“é¨“å­¦ç¿’ã‚’å¤§åˆ‡ã«ã—ã¦ã„ã¾ã™ã€‚${interestsText}ã«èˆˆå‘³ãŒã‚ã‚‹è»¢æ ¡å¸Œæœ›ã®ç”Ÿå¾’ã«å‘ã‘ã¦ã€ãã®èˆˆå‘³ã¨å­¦æ ¡ã®ç‰¹è‰²ï¼ˆå·éŠã³ã€ã‚†ãšã®åç©«ã€åœ°åŸŸã®ãŠç¥­ã‚Šãªã©ï¼‰ã‚’ç››ã‚Šè¾¼ã¿ãªãŒã‚‰ã€å­¦æ ¡ã§ã®æ¥½ã—ã„ä¸€æ—¥ã‚’æƒ³åƒã•ã›ã‚‹çŸ­ã„ç‰©èªï¼ˆ200å­—ç¨‹åº¦ï¼‰ã‚’æ—¥æœ¬èªã§ä½œæˆã—ã¦ãã ã•ã„ã€‚ç‰©èªã®æ–‡ç« ã ã‘ã‚’è¿”ã—ã¦ãã ã•ã„ã€‚`;
                const story = await callGeminiApi(prompt);
                loader.classList.add('hidden');
                storyTextElem.textContent = story;
            });

            askQaBtn.addEventListener('click', async () => {
                const question = qaInput.value.trim();
                if (!question) {
                    storyTextElem.textContent = 'è³ªå•ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚';
                    return;
                }
                storyTextElem.textContent = '';
                loader.classList.remove('hidden');
                const schoolInfo = `- å­¦æ ¡å: é¦™ç¾å¸‚ç«‹å¤§æ ƒå°ãƒ»ä¸­å­¦æ ¡\n- ç‰¹å¾´: å°ä¸­ä¸€è²«æ•™è‚²ã€ç‰¹èªæ ¡åˆ¶åº¦ï¼ˆé¦™ç¾å¸‚å…¨åŸŸã‹ã‚‰é€šå­¦å¯èƒ½ï¼‰\n- æ•™è‚²æ–¹é‡: ã‚¤ã‚¨ãƒŠãƒ—ãƒ©ãƒ³æ•™è‚²ã®ã‚¨ãƒƒã‚»ãƒ³ã‚¹ã‚’å–ã‚Šå…¥ã‚Œã€å¯¾è©±ã‚„å”åŠ›ã‚’é‡è¦–ã€‚å°‘äººæ•°æ•™è‚²ã€‚ICTæ´»ç”¨ã€‚\n- ç’°å¢ƒ: è±Šã‹ãªè‡ªç„¶ã«å›²ã¾ã‚Œã¦ã„ã‚‹ã€‚\n- æ´»å‹•: ç™»å±±ã€å·éŠã³ã€ã‚†ãšã®åç©«ã€ãŠèŒ¶ç…ã‚Šä½“é¨“ã€åœ°åŸŸã®ãŠç¥­ã‚Šå‚åŠ ãªã©ã€è‡ªç„¶ã‚„åœ°åŸŸã¨é€£æºã—ãŸä½“é¨“å­¦ç¿’ãŒè±Šå¯Œã€‚\n- äº¤æµ: åŒ—æµ·é“ç©ä¸¹ç”ºã€éŸ“å›½ã€é«˜çŸ¥å·¥ç§‘å¤§å­¦ãªã©ã¨äº¤æµæ´»å‹•ãŒã‚ã‚‹ã€‚\n- å­¦æ ¡ç”Ÿæ´»: çµ¦é£ŸãŒç¾å‘³ã—ã„ã¨è©•åˆ¤ã€‚ä¸­å­¦æ ¡ã®åˆ¶æœã¯æ–°ã—ã„ãƒ‡ã‚¶ã‚¤ãƒ³ã€‚å°ä¸­åˆåŒè¡Œäº‹ã‚‚å¤šã„ã€‚\n- é€šå­¦: åœŸä½å±±ç”°ç”ºã‹ã‚‰ã®ãƒã‚¹æ–™é‡‘ã¯å¸‚ã®è£œåŠ©ã§å®Ÿè³ªç„¡æ–™ã€‚`;
                const prompt = `ã‚ãªãŸã¯é¦™ç¾å¸‚ç«‹å¤§æ ƒå°ãƒ»ä¸­å­¦æ ¡ã®è¦ªåˆ‡ãªAIç›¸è«‡å“¡ã§ã™ã€‚ä»¥ä¸‹ã®å­¦æ ¡æƒ…å ±ã«åŸºã¥ã„ã¦ã€ä¸å¯§ã§åˆ†ã‹ã‚Šã‚„ã™ã„è¨€è‘‰ã‚’ä½¿ã„ã€å­ä¾›ãŸã¡ã‚„ä¿è­·è€…ã‹ã‚‰ã®è³ªå•ã«æ—¥æœ¬èªã§ç­”ãˆã¦ãã ã•ã„ã€‚\n\n[å­¦æ ¡æƒ…å ±]\n${schoolInfo}\n\n[è³ªå•]\n${question}`;
                const answer = await callGeminiApi(prompt);
                loader.classList.add('hidden');
                storyTextElem.textContent = answer;
            });

            const ctx = document.getElementById('learningMixChart').getContext('2d');
            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['è‡ªç„¶ä½“é¨“', 'åœ°åŸŸäº¤æµ', 'å­¦æ ¡ã§ã®å­¦ã³'],
                    datasets: [{ data: [40, 35, 25], backgroundColor: ['#06D6A0', '#FFD166', '#118AB2'], borderColor: '#F8F9FA', borderWidth: 6, hoverOffset: 8 }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '60%',
                    plugins: {
                        legend: { position: 'bottom', labels: { padding: 20, font: { size: 16 } } },
                        tooltip: {
                            callbacks: {
                                title: (tooltipItems) => {
                                    let label = tooltipItems[0].chart.data.labels[tooltipItems[0].dataIndex];
                                    return Array.isArray(label) ? label.join(' ') : label;
                                }
                            }
                        }
                    }
                }
            });
        });
    </script>
</body>
</html>
